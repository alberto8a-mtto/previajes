<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#2563eb">
    <meta name="description" content="Sistema de Inspecci√≥n Vehicular PreViajes - Gesti√≥n completa de inspecciones de buses">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="PreViajes">
    
    <title>PreViajes - Alberto Ochoa</title>
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json">
    
    <!-- Iconos -->
    <link rel="icon" type="image/png" sizes="192x192" href="icon-192.png">
    <link rel="icon" type="image/png" sizes="512x512" href="icon-512.png">
    <link rel="apple-touch-icon" href="icon-192.png">
    
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <header>
            <div class="header-content">
                <div class="header-title">
                    <img src="LOGO-ALBERTO-OCHOA.jpg" alt="Alberto Ochoa" style="height: 50px; margin-right: 12px; vertical-align: middle;">
                    <h1 style="display: inline-block; vertical-align: middle;">PreViajes</h1>
                    <p id="headerSubtitle">Inspecci√≥n completa de veh√≠culo - Todas las verificaciones</p>
                </div>
            </div>
        </header>

        <!-- Barra de Progreso -->
        <div id="progressBar" class="progress-bar" style="display: none;">
            <div class="progress-fill"></div>
            <div class="progress-text">0 de 6 m√≥dulos completados</div>
        </div>

        <form id="inspeccionForm">
            <!-- PASO 1: Informaci√≥n General -->
            <section id="seccionInfoGeneral" class="card active-section">
                <h2>üìã Informaci√≥n General</h2>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="numeroInterno">N√∫mero Interno: *</label>
                        <input type="text" 
                               id="numeroInterno" 
                               name="numeroInterno" 
                               placeholder="Buscar n√∫mero o placa..." 
                               list="busesDatalist"
                               required>
                        <datalist id="busesDatalist"></datalist>
                    </div>

                    <div class="form-group">
                        <label for="placa">Placa:</label>
                        <input type="text" id="placa" name="placa" readonly>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="km">Kilometraje: *</label>
                        <input type="number" id="km" name="km" min="0" placeholder="150000" required>
                    </div>

                    <div class="form-group">
                        <label for="fechaInspeccion">Fecha Inspecci√≥n: *</label>
                        <input type="datetime-local" id="fechaInspeccion" name="fechaInspeccion" required>
                    </div>
                </div>

                <div class="form-group">
                    <label for="conductorId">Conductor: *</label>
                    <input type="text" 
                           id="conductorId" 
                           name="conductorId" 
                           placeholder="Buscar conductor..." 
                           list="conductoresDatalist"
                           required>
                    <datalist id="conductoresDatalist"></datalist>
                </div>

                <div class="form-group">
                    <label for="inspectorNombre">Inspector: *</label>
                    <input type="text" 
                           id="inspectorNombre" 
                           name="inspectorNombre" 
                           placeholder="Ingrese nombre del inspector..." 
                           required>
                    <small>Nombre de la persona que realiza esta inspecci√≥n</small>
                </div>

                <div class="actions">
                    <button type="button" class="btn btn-primary" onclick="irAModulos()">
                        Continuar a M√≥dulos de Inspecci√≥n ‚Üí
                    </button>
                </div>
            </section>

            <!-- PASO 2: Galer√≠a de M√≥dulos -->
            <section id="seccionModulos" class="card" style="display: none;">
                <h2>üîç Seleccione el M√≥dulo a Inspeccionar</h2>
                <p class="info-text">Haga clic en cada m√≥dulo para realizar la inspecci√≥n correspondiente</p>
                
                <div class="modulos-galeria">
                    <div class="modulo-card" onclick="abrirModulo('llantas')" id="moduloLlantas">
                        <div class="modulo-icon">üõû</div>
                        <h3>Profundidad de Llantas</h3>
                        <p>Inspecci√≥n de neum√°ticos</p>
                        <span class="modulo-status">Pendiente</span>
                    </div>

                    <div class="modulo-card" onclick="abrirModulo('carroceria')" id="moduloCarroceria">
                        <div class="modulo-icon">üöå</div>
                        <h3>Carrocer√≠a</h3>
                        <p>Faldones, vidrios y espejos</p>
                        <span class="modulo-status">Pendiente</span>
                    </div>

                    <div class="modulo-card" onclick="abrirModulo('luces')" id="moduloLuces">
                        <div class="modulo-icon">üí°</div>
                        <h3>Sistema de Luces y Pitos</h3>
                        <p>Todas las luces y pitos del veh√≠culo</p>
                        <span class="modulo-status">Pendiente</span>
                    </div>

                    <div class="modulo-card" onclick="abrirModulo('senalizacion')" id="moduloSenalizacion">
                        <div class="modulo-icon">üîÜ</div>
                        <h3>Se√±alizaci√≥n y Emblemas</h3>
                        <p>Cintas reflectivas y emblemas</p>
                        <span class="modulo-status">Pendiente</span>
                    </div>

                    <div class="modulo-card" onclick="abrirModulo('seguridad')" id="moduloSeguridad">
                        <div class="modulo-icon">üßØ</div>
                        <h3>Equipamiento de Seguridad</h3>
                        <p>Extintores y tomas de corriente</p>
                        <span class="modulo-status">Pendiente</span>
                    </div>

                    <div class="modulo-card" onclick="abrirModulo('documentacion')" id="moduloDocumentacion">
                        <div class="modulo-icon">üìÑ</div>
                        <h3>Documentaci√≥n</h3>
                        <p>SOAT, RTM y licencias</p>
                        <span class="modulo-status">Pendiente</span>
                    </div>
                </div>

                <div class="actions">
                    <button type="button" class="btn btn-secondary" onclick="volverAInfoGeneral()">
                        ‚Üê Volver
                    </button>
                    <button type="button" class="btn btn-primary" onclick="irAFirmas()">
                        Continuar a Firmas y Evidencias ‚Üí
                    </button>
                </div>
            </section>

            <!-- M√ìDULO: Profundidad de Llantas -->
            <section id="moduloDetallellantas" class="card modulo-detalle" style="display: none;">
                <div class="modulo-header">
                    <h2>üõû Profundidad de Llantas</h2>
                    <button type="button" class="btn-close-modulo" onclick="cerrarModulo()">‚úï</button>
                </div>
                
                <p class="info-text">
                    ‚ö†Ô∏è Ingrese las profundidades en mil√≠metros (mm). Valores <strong style="color: #ef4444;">menores a 3mm se marcar√°n en rojo</strong> (cr√≠tico).
                </p>

                <!-- Grid de 24 Llantas -->
                <div id="llantasGrid" class="llantas-grid">
                    <!-- Se generar√°n din√°micamente con JavaScript -->
                </div>

                <!-- Advertencia de Llantas Cr√≠ticas -->
                <div id="llantasCriticasWarning" style="display: none; background-color: #fef3c7; border-left: 4px solid #f59e0b; padding: 16px; margin: 24px 0; border-radius: 6px;">
                    <p style="margin: 0; color: #92400e; font-weight: 500;">
                        ‚ö†Ô∏è <strong>Atenci√≥n:</strong> Se detectaron <span id="llantasCriticasCount" style="font-weight: 700;">0</span> llantas con medidas cr√≠ticas (<3mm). 
                        Debe adjuntar evidencia fotogr√°fica para cada una.
                    </p>
                </div>

                <!-- Contenedor de Evidencias Fotogr√°ficas -->
                <div id="evidenciasLlantasContainer" style="display: none; margin-top: 24px;">
                    <h3 style="color: #ef4444; margin-bottom: 16px;">üì∏ Evidencias Fotogr√°ficas Obligatorias</h3>
                    <div id="evidenciasLlantasGrid" class="evidencias-llantas-grid">
                        <!-- Se generar√°n din√°micamente inputs para cada llanta cr√≠tica -->
                    </div>
                </div>

                <div class="form-group" style="margin-top: 24px;">
                    <label for="observacionesLlantas">Observaciones Adicionales:</label>
                    <textarea id="observacionesLlantas" 
                              name="observacionesLlantas" 
                              rows="3" 
                              placeholder="Describa cualquier anomal√≠a o detalle importante sobre las llantas..."></textarea>
                </div>

                <div class="actions">
                    <button type="button" class="btn btn-success" onclick="guardarModulo('llantas')">
                        ‚úì Guardar y Volver
                    </button>
                </div>
            </section>

            <!-- M√ìDULO: Carrocer√≠a -->
            <section id="moduloDetallecarroceria" class="card modulo-detalle" style="display: none;">
                <div class="modulo-header">
                    <h2>üöå Carrocer√≠a</h2>
                    <button type="button" class="btn-close-modulo" onclick="cerrarModulo()">‚úï</button>
                </div>
                
                <p class="info-text" id="carroceriaInfoNOK" style="display: none; background-color: #fee2e2; border-left-color: #ef4444;">
                    ‚ö†Ô∏è <strong>Atenci√≥n:</strong> Se detectaron elementos MALOS. Debe adjuntar evidencia fotogr√°fica obligatoriamente.
                </p>

                <div class="inspection-grid">
                    <div class="form-group">
                        <label for="carroceriaFaldones">Faldones: *</label>
                        <select id="carroceriaFaldones" name="carroceriaFaldones" class="carroceria-select" required>
                            <option value="">Seleccionar...</option>
                            <option value="BUENO">‚úÖ BUENO</option>
                            <option value="MALO">‚ùå MALO</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="carroceriaVidrios">Vidrios: *</label>
                        <select id="carroceriaVidrios" name="carroceriaVidrios" class="carroceria-select" required>
                            <option value="">Seleccionar...</option>
                            <option value="BUENO">‚úÖ BUENO</option>
                            <option value="MALO">‚ùå MALO</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="carroceriaEspejos">Espejos: *</label>
                        <select id="carroceriaEspejos" name="carroceriaEspejos" class="carroceria-select" required>
                            <option value="">Seleccionar...</option>
                            <option value="BUENO">‚úÖ BUENO</option>
                            <option value="MALO">‚ùå MALO</option>
                        </select>
                    </div>
                </div>

                <!-- Evidencias Fotogr√°ficas para Carrocer√≠a -->
                <div id="carroceriaEvidenciasSection" style="margin-top: 24px;">
                    <div class="form-group">
                        <label for="evidenciasCarroceria">
                            üì∏ Evidencias Fotogr√°ficas:
                            <span id="carroceriaEvidenciaRequerida" style="display: none; color: #ef4444; font-weight: bold;"> (OBLIGATORIO)</span>
                        </label>
                        <input type="file" 
                               id="evidenciasCarroceria" 
                               name="evidenciasCarroceria" 
                               accept="image/*" 
                               multiple 
                               capture="environment">
                        <small>Adjunte fotos de los elementos con problemas</small>
                    </div>
                    <div id="previewEvidenciasCarroceria" class="preview-container"></div>
                </div>

                <div class="actions">
                    <button type="button" class="btn btn-success" onclick="guardarModulo('carroceria')">
                        ‚úì Guardar y Volver
                    </button>
                </div>
            </section>

            <!-- M√ìDULO: Sistema de Luces y Pitos -->
            <section id="moduloDetalleluces" class="card modulo-detalle" style="display: none;">
                <div class="modulo-header">
                    <h2>üí° Sistema de Luces y Pitos</h2>
                    <button type="button" class="btn-close-modulo" onclick="cerrarModulo()">‚úï</button>
                </div>
                
                <div class="inspection-grid">
                    <div class="form-group">
                        <label for="lucesMedias">Luces Medias: *</label>
                        <select id="lucesMedias" name="lucesMedias" required>
                            <option value="">Seleccionar...</option>
                            <option value="BUENO">‚úÖ BUENO</option>
                            <option value="MALO">‚ùå MALO</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="lucesAltas">Luces Altas: *</label>
                        <select id="lucesAltas" name="lucesAltas" required>
                            <option value="">Seleccionar...</option>
                            <option value="BUENO">‚úÖ BUENO</option>
                            <option value="MALO">‚ùå MALO</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="lucesPosicionamiento">Luces Posicionamiento: *</label>
                        <select id="lucesPosicionamiento" name="lucesPosicionamiento" required>
                            <option value="">Seleccionar...</option>
                            <option value="BUENO">‚úÖ BUENO</option>
                            <option value="MALO">‚ùå MALO</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="lucesReversa">Luces Reversa: *</label>
                        <select id="lucesReversa" name="lucesReversa" required>
                            <option value="">Seleccionar...</option>
                            <option value="BUENO">‚úÖ BUENO</option>
                            <option value="MALO">‚ùå MALO</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="lucesStop">Luces Stop: *</label>
                        <select id="lucesStop" name="lucesStop" required>
                            <option value="">Seleccionar...</option>
                            <option value="BUENO">‚úÖ BUENO</option>
                            <option value="MALO">‚ùå MALO</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="pito">Pito: *</label>
                        <select id="pito" name="pito" required>
                            <option value="">Seleccionar...</option>
                            <option value="BUENO">‚úÖ BUENO</option>
                            <option value="MALO">‚ùå MALO</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="pitoServicio">Pito de Servicio: *</label>
                        <select id="pitoServicio" name="pitoServicio" required>
                            <option value="">Seleccionar...</option>
                            <option value="BUENO">‚úÖ BUENO</option>
                            <option value="MALO">‚ùå MALO</option>
                        </select>
                    </div>
                </div>

                <div class="actions">
                    <button type="button" class="btn btn-success" onclick="guardarModulo('luces')">
                        ‚úì Guardar y Volver
                    </button>
                </div>
            </section>

            <!-- M√ìDULO: Se√±alizaci√≥n y Emblemas -->
            <section id="moduloDetallesenalizacion" class="card modulo-detalle" style="display: none;">
                <div class="modulo-header">
                    <h2>üîÜ Se√±alizaci√≥n y Emblemas</h2>
                    <button type="button" class="btn-close-modulo" onclick="cerrarModulo()">‚úï</button>
                </div>
                
                <div class="inspection-grid">
                    <div class="form-group">
                        <label for="cintasReflectivasLaterales">Cintas Reflectivas Laterales: *</label>
                        <select id="cintasReflectivasLaterales" name="cintasReflectivasLaterales" required>
                            <option value="">Seleccionar...</option>
                            <option value="BUENO">‚úÖ BUENO</option>
                            <option value="MALO">‚ùå MALO</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="cintasReflectivasTrasera">Cintas Reflectivas Trasera: *</label>
                        <select id="cintasReflectivasTrasera" name="cintasReflectivasTrasera" required>
                            <option value="">Seleccionar...</option>
                            <option value="BUENO">‚úÖ BUENO</option>
                            <option value="MALO">‚ùå MALO</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="emblemasLaterales">Emblemas Laterales: *</label>
                        <select id="emblemasLaterales" name="emblemasLaterales" required>
                            <option value="">Seleccionar...</option>
                            <option value="BUENO">‚úÖ BUENO</option>
                            <option value="MALO">‚ùå MALO</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="emblemasFrontales">Emblemas Frontales: *</label>
                        <select id="emblemasFrontales" name="emblemasFrontales" required>
                            <option value="">Seleccionar...</option>
                            <option value="BUENO">‚úÖ BUENO</option>
                            <option value="MALO">‚ùå MALO</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="emblemasTraseros">Emblemas Traseros: *</label>
                        <select id="emblemasTraseros" name="emblemasTraseros" required>
                            <option value="">Seleccionar...</option>
                            <option value="BUENO">‚úÖ BUENO</option>
                            <option value="MALO">‚ùå MALO</option>
                        </select>
                    </div>
                </div>

                <div class="actions">
                    <button type="button" class="btn btn-success" onclick="guardarModulo('senalizacion')">
                        ‚úì Guardar y Volver
                    </button>
                </div>
            </section>

            <!-- M√ìDULO: Equipamiento de Seguridad -->
            <section id="moduloDetalleseguridad" class="card modulo-detalle" style="display: none;">
                <div class="modulo-header">
                    <h2>üßØ Equipamiento de Seguridad</h2>
                    <button type="button" class="btn-close-modulo" onclick="cerrarModulo()">‚úï</button>
                </div>
                
                <div class="inspection-grid">
                    <div class="form-group">
                        <label for="extintoresCabina">Extintores Cabina: *</label>
                        <select id="extintoresCabina" name="extintoresCabina" required>
                            <option value="">Seleccionar...</option>
                            <option value="BUENO">‚úÖ BUENO</option>
                            <option value="MALO">‚ùå MALO</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="extintoresBodega">Extintores Bodega: *</label>
                        <select id="extintoresBodega" name="extintoresBodega" required>
                            <option value="">Seleccionar...</option>
                            <option value="BUENO">‚úÖ BUENO</option>
                            <option value="MALO">‚ùå MALO</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="tomaCorrienteEspalda">Toma Corriente Espalda: *</label>
                        <select id="tomaCorrienteEspalda" name="tomaCorrienteEspalda" required>
                            <option value="">Seleccionar...</option>
                            <option value="BUENO">‚úÖ BUENO</option>
                            <option value="MALO">‚ùå MALO</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="tomaCorrienteSilla">Toma Corriente Silla: *</label>
                        <select id="tomaCorrienteSilla" name="tomaCorrienteSilla" required>
                            <option value="">Seleccionar...</option>
                            <option value="BUENO">‚úÖ BUENO</option>
                            <option value="MALO">‚ùå MALO</option>
                        </select>
                    </div>
                </div>

                <div class="actions">
                    <button type="button" class="btn btn-success" onclick="guardarModulo('seguridad')">
                        ‚úì Guardar y Volver
                    </button>
                </div>
            </section>

            <!-- M√ìDULO: Documentaci√≥n -->
            <section id="moduloDetalledocumentacion" class="card modulo-detalle" style="display: none;">
                <div class="modulo-header">
                    <h2>üìÑ Documentaci√≥n</h2>
                    <button type="button" class="btn-close-modulo" onclick="cerrarModulo()">‚úï</button>
                </div>
                
                <div class="inspection-grid">
                    <div class="form-group">
                        <label for="documentosSoat">SOAT: *</label>
                        <select id="documentosSoat" name="documentosSoat" required>
                            <option value="">Seleccionar...</option>
                            <option value="BUENO">‚úÖ BUENO</option>
                            <option value="MALO">‚ùå MALO</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="documentosRtm">RTM (Revisi√≥n T√©cnico Mec√°nica): *</label>
                        <select id="documentosRtm" name="documentosRtm" required>
                            <option value="">Seleccionar...</option>
                            <option value="BUENO">‚úÖ BUENO</option>
                            <option value="MALO">‚ùå MALO</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="documentosTarjetaOperacion">Tarjeta de Operaci√≥n: *</label>
                        <select id="documentosTarjetaOperacion" name="documentosTarjetaOperacion" required>
                            <option value="">Seleccionar...</option>
                            <option value="BUENO">‚úÖ BUENO</option>
                            <option value="MALO">‚ùå MALO</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="licenciaConduccionConductor">Licencia de Conducci√≥n Conductor: *</label>
                        <select id="licenciaConduccionConductor" name="licenciaConduccionConductor" required>
                            <option value="">Seleccionar...</option>
                            <option value="BUENO">‚úÖ BUENO</option>
                            <option value="MALO">‚ùå MALO</option>
                        </select>
                    </div>
                </div>

                <div class="actions">
                    <button type="button" class="btn btn-success" onclick="guardarModulo('documentacion')">
                        ‚úì Guardar y Volver
                    </button>
                </div>
            </section>

            <!-- PASO 3: Firmas y Evidencias -->
            <!-- PASO 3: Firmas y Evidencias -->
            <section id="seccionFirmas" class="card" style="display: none;">
                <h2>‚úçÔ∏è Firmas y Evidencias</h2>
                
                <div class="signature-row">
                    <div class="signature-group">
                        <label>Firma del Conductor: *</label>
                        <div class="signature-pad-container">
                            <canvas id="firmaConductor" width="400" height="200"></canvas>
                            <button type="button" class="btn-clear-signature" onclick="limpiarFirma('firmaConductor')">üóëÔ∏è Limpiar</button>
                        </div>
                    </div>
                    <div class="signature-group">
                        <label>Firma del Inspector: *</label>
                        <div class="signature-pad-container">
                            <canvas id="firmaInspector" width="400" height="200"></canvas>
                            <button type="button" class="btn-clear-signature" onclick="limpiarFirma('firmaInspector')">üóëÔ∏è Limpiar</button>
                        </div>
                    </div>
                </div>

                <div class="form-group" style="margin-top: 24px;">
                    <label for="evidencias">üì∏ Evidencias Fotogr√°ficas (opcional):</label>
                    <input type="file" 
                           id="evidencias" 
                           name="evidencias" 
                           accept="image/*" 
                           multiple 
                           capture="environment">
                    <small>Puedes seleccionar m√∫ltiples fotos</small>
                </div>
                <div id="previewEvidencias" class="preview-container"></div>

                <div class="actions">
                    <button type="button" class="btn btn-secondary" onclick="volverAModulos()">
                        ‚Üê Volver a M√≥dulos
                    </button>
                    <button type="submit" class="btn btn-primary">
                        üíæ Guardar Inspecci√≥n Completa
                    </button>
                </div>
            </section>
        </form>

        <!-- Loading Overlay -->
        <div id="loadingOverlay" class="loading-overlay" style="display: none;">
            <div class="spinner"></div>
            <p>Guardando inspecci√≥n...</p>
        </div>

        <!-- Toast Notification -->
        <div id="toast" class="toast"></div>
    </div>

    <script src="app.js"></script>
    <script>
        // Registrar Service Worker para PWA
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('service-worker.js')
                    .then(registration => {
                        console.log('Service Worker registrado:', registration);
                    })
                    .catch(error => {
                        console.log('Error al registrar Service Worker:', error);
                    });
            });
        }

        // Detectar instalaci√≥n de PWA
        let deferredPrompt;
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            
            // Mostrar notificaci√≥n para instalar app
            const installToast = document.createElement('div');
            installToast.className = 'install-toast';
            installToast.innerHTML = `
                <div class="install-toast-content">
                    <span>üì± Instalar PreViajes como aplicaci√≥n</span>
                    <button onclick="instalarApp()" class="btn-install-toast">Instalar</button>
                    <button onclick="this.parentElement.parentElement.remove()" class="btn-close-toast">‚úï</button>
                </div>
            `;
            document.body.appendChild(installToast);
        });

        function instalarApp() {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                deferredPrompt.userChoice.then((choiceResult) => {
                    if (choiceResult.outcome === 'accepted') {
                        console.log('App instalada');
                    }
                    deferredPrompt = null;
                    document.querySelector('.install-toast')?.remove();
                });
            }
        }
    </script>
</body>
</html>
